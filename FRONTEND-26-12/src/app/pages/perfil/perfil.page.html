<ion-header class="header-fixed">
  <ion-toolbar color="danger">
    <div class="top-bar" slot="start">
      <div class="logo brand-logo">
        <img src="assets/logos/logo1cefoodsbranca.png" alt="Cefoods logo" />
      </div>
      <ion-buttons slot="end">
        <ion-button (click)="abrirMenu()">
          <ion-icon name="settings-outline"></ion-icon>
        </ion-button>
      </ion-buttons>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content>

  <!-- Card com informações do usuário -->
  <ion-card *ngIf="usuarioLogado">
    <ion-item lines="none">
      <ion-avatar slot="start">
        <img [src]="usuarioLogado.fotoPerfil || 'assets/img/default-user.png'" style="height: 36px;" alt="Foto do usuário" />
      </ion-avatar>
      <ion-label>
        <h2>{{ usuarioLogado.nome }} {{ usuarioLogado.sobrenome }}</h2>
        <p>{{ usuarioLogado.email }}</p>
        <p *ngIf="usuarioLogado.telefone">{{ usuarioLogado.telefone }}</p>
        <p>{{ usuarioLogado.tipoUsuario }}</p>
      </ion-label>
    </ion-item>
    <ion-button expand="block" (click)="irEditarPerfil()" color="warning">EDITAR</ion-button>
  </ion-card>

  <h2 style="margin-left: 16px; font-weight: bold;">Histórico de Pedidos</h2>

  <!-- Mensagem caso não haja pedidos -->
  <div *ngIf="historicoPedidos.length === 0" style="text-align: center; margin-top: 20px;">
    <ion-icon name="cart-outline" style="font-size: 3rem; color: #ccc;"></ion-icon>
    <p>Você ainda não possui pedidos no histórico.</p>
  </div>

  <!-- Lista de pedidos -->
  <ion-card *ngFor="let pedido of historicoPedidos">
    <ion-card-header>
      <ion-card-title>Pedido #{{ pedido.idPedido }}</ion-card-title>
      <ion-badge [color]="pedido.status === 'PENDING' ? 'warning' 
                          : pedido.status === 'ACCEPTED' ? 'primary' 
                          : pedido.status === 'COMPLETED' ? 'success' 
                          : 'danger'">
        {{ pedido.status }}
      </ion-badge>
      <p class="pedido-data">{{ pedido.dataPedido | date:'dd/MM/yyyy HH:mm' }}</p>
    </ion-card-header>

    <ion-card-content>
      <p><strong>Pagamento:</strong> {{ pedido.formaPagamento }}</p>

      <div *ngIf="deveMostrarPix(pedido)" class="pix-info">
        <div class="pix-header">
          <ion-icon name="key-outline"></ion-icon>
          <div>
            <p class="pix-title">Pagamento confirmado via PIX</p>
            <small>Envie o valor usando a chave abaixo e apresente o comprovante.</small>
          </div>
        </div>
        <div class="pix-key-line">
          <span>{{ pedido.chavePixLoja }}</span>
          <ion-button fill="clear" size="small" color="dark" (click)="copiarChavePix(pedido.chavePixLoja)">
            <ion-icon slot="icon-only" name="copy-outline"></ion-icon>
          </ion-button>
        </div>
      </div>

      <div class="pedido-itens">
        <p><strong>Itens do pedido:</strong></p>
        <div *ngFor="let item of pedido.itens" class="item-linha">
          <span>{{ item.quantidade }}x {{ item.nomeProduto }}</span>
          <span>{{ (item.subtotal) | currency:'BRL' }}</span>
        </div>
      </div>

      <p class="pedido-total">
        <strong>Total:</strong> {{ pedido.valorTotal | currency:'BRL' }}
      </p>
    </ion-card-content>
  </ion-card>


</ion-content>

<!-- Footer -->
<ion-footer class="footer-fixed">
  <ion-toolbar>
    <div class="bottom-bar">
      <button class="btn-icon" routerLink="/inicio">
        <ion-icon name="home"></ion-icon>
      </button>
      <button class="btn-icon" (click)="irPesquisa()">
        <ion-icon name="search"></ion-icon>
      </button>
      <button class="btn-icon" routerLink="/conversas"><ion-icon name="chatbubbles"></ion-icon></button>
      <button class="btn-icon" (click)="abrirLojaIcon()">
        <ion-icon name="storefront"></ion-icon>
      </button>
      <button class="btn-icon" (click)="irPerfil()">
        <ion-icon name="person"></ion-icon>
      </button>
  
    </div>
  </ion-toolbar>
</ion-footer>