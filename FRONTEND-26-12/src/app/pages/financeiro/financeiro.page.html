<ion-header class="header-fixed">
  <ion-toolbar color="danger">
    <div class="top-bar" slot="start">
      <div class="logo brand-logo">
        <img src="assets/logos/logo1cefoodsbranca.png" alt="Cefoods logo" />
      </div>
    </div>
  </ion-toolbar>
</ion-header>

<div class="voltar-container">
  <ion-button fill="clear" color="dark" (click)="voltar()">
    <ion-icon name="arrow-back-outline" slot="start"></ion-icon>
    VOLTAR
  </ion-button>
</div>

<ion-content class="financeiro-content">
  <section class="financeiro-hero" *ngIf="loja">
    <div class="hero-header">
      <div>
        <p class="eyebrow">Visão financeira</p>
        <h2>{{ loja.nomeFantasia }}</h2>
      </div>
      <ion-button fill="outline" size="small" color="dark" (click)="irRelatorios()">
        <ion-icon slot="start" name="document-text-outline"></ion-icon>
        Relatórios
      </ion-button>
    </div>
    <div class="hero-metrics">
      <article>
        <p class="metric-label">Receita total</p>
        <h3>{{ receitaTotal | currency:'BRL' }}</h3>
      </article>
      <article>
        <p class="metric-label">Ticket médio (por pedido)</p>
        <h3>{{ ticketMedio | currency:'BRL' }}</h3>
      </article>
      <article>
        <p class="metric-label">Itens vendidos</p>
        <h3>{{ itensVendidos }}</h3>
      </article>
      <article>
        <p class="metric-label">Pedidos recebidos</p>
        <h3>{{ totalPedidosRecebidos }}</h3>
        <p class="metric-note">
          {{ pedidosAceitos }} aceitos · {{ pedidosRecusados }} recusados
        </p>
      </article>
      <article>
        <p class="metric-label">Taxa de conversão</p>
        <h3>{{ taxaConversao | number:'1.0-1' }}%</h3>
        <p class="metric-note">Calculada sobre pedidos concluídos</p>
      </article>
    </div>

    <div class="lucro-wrapper">
      <label>Calcular lucro estimado</label>
      <div class="lucro-inputs">
        <ion-input type="number" placeholder="Total gasto em produção"
          [(ngModel)]="custoTotalInput"
          inputmode="decimal"
          class="custo-input">
        </ion-input>
        <ion-button fill="solid" color="dark" (click)="calcularLucro()">Calcular</ion-button>
      </div>
      <p class="lucro-resultado" *ngIf="lucroEstimado !== null">
        Lucro estimado:
        <strong [ngClass]="{ positivo: lucroEstimado >= 0, negativo: lucroEstimado < 0 }">
          {{ lucroEstimado | currency:'BRL' }}
        </strong>
      </p>
    </div>
  </section>

  <section class="charts-grid">
    <ion-card class="chart-card">
    <ion-card-header>
      <ion-card-title>Formas de Pagamento</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <canvas id="graficoPagamentos"></canvas>
    </ion-card-content>
  </ion-card>

  <ion-card class="chart-card">
    <ion-card-header>
      <ion-card-title>Receita por Dia</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <canvas id="graficoReceitaDia"></canvas>
    </ion-card-content>
  </ion-card>

  <ion-card class="chart-card">
    <ion-card-header>
      <ion-card-title>Produtos Mais Vendidos</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <canvas id="graficoProdutos"></canvas>
    </ion-card-content>
  </ion-card>
  </section>

  <ion-card class="tabela-card spacing-bottom">
    <ion-card-header>
      <ion-card-title>Tabela de Produtos</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-grid>
        <ion-row>
          <ion-col><strong>Produto</strong></ion-col>
          <ion-col><strong>Qtd</strong></ion-col>
          <ion-col><strong>Receita</strong></ion-col>
        </ion-row>
        <ion-row *ngFor="let prod of receitaPorProduto">
          <ion-col>{{ prod.nome }}</ion-col>
          <ion-col>{{ prod.quant }}</ion-col>
          <ion-col>{{ prod.total | currency:'BRL' }}</ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>
</ion-content>

<ion-footer class="footer-fixed">
  <ion-toolbar>
    <div class="bottom-bar">
      <button class="btn-icon" routerLink="/inicio">
        <ion-icon name="home"></ion-icon>
      </button>
      <button class="btn-icon" (click)="irPesquisa()">
        <ion-icon name="search"></ion-icon>
      </button>
      <button class="btn-icon" routerLink="/conversas">
        <ion-icon name="chatbubbles"></ion-icon>
      </button>
      <button class="btn-icon" (click)="abrirLojaIcon()">
        <ion-icon name="storefront"></ion-icon>
      </button>
      <button class="btn-icon" (click)="irPerfil()">
        <ion-icon name="person"></ion-icon>
      </button>
    </div>
  </ion-toolbar>
</ion-footer>
